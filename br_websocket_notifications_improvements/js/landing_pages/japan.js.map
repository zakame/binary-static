{"version":3,"sources":["../../../../src/javascript/landing_pages/japan.js"],"names":["window","onload","getClientCountry","jpClient","location","urlForLanguage","initForm","recordAffiliateExposure","commonOnload","gclid","getParamValue","document","referrer","localStorage","setItem","id","signup_form","getElementById","ws","wsConnect","email_sent","sendVerifyEmail","val","checkCountry","trimmed_email","trimEmail","wsSend","verify_email","type","verifySubmit","msg","response","JSON","parse","data","setValidationStyle","el_email","error","querySelectorAll","forEach","el","querySelector","classList","add","remove","str","replace","clients_country","sessionStorage","getItem","test","connect","onmessage","onclose","validation_set","addEventListener","handleSubmit","e","preventDefault","el_form","validateEmail","value","evt","to","offsetTop","scrollTo","readyState","onopen","email","form","element","has_error","error_class","invisible_class","length","accounts","Object","keys","some","loginid","residence","setSession","sendRequests","website_status","time"],"mappings":"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","file":"japan.js","sourcesContent":["/* global setSession:true */\n/* global urlForLanguage:true */\n/* global getLanguage:true */\n/* global jpClient:true */\n/* global recordAffiliateExposure:true */\nwindow.onload = function() {\n    getClientCountry();\n    if (!jpClient()) {\n        window.location = urlForLanguage('ja');\n    }\n\n    initForm('email_top');\n    initForm('email_middle');\n    initForm('email_bottom');\n    recordAffiliateExposure();\n    commonOnload();\n\n    // Store gclid\n    const gclid = getParamValue(document.referrer, 'gclid');\n    if (gclid) {\n        localStorage.setItem('gclid', gclid);\n    }\n};\n\nfunction initForm(id) {\n    const signup_form = document.getElementById(id);\n\n    if (!signup_form) {\n        return;\n    }\n    let ws = wsConnect();\n    let email_sent = false;\n\n    function sendVerifyEmail(val) {\n        if (!checkCountry(val)) {\n            return;\n        }\n        const trimmed_email = trimEmail(val);\n        wsSend(ws, {\n            verify_email: trimmed_email,\n            type        : 'account_opening',\n        });\n    }\n\n    function verifySubmit(msg) {\n        const response = JSON.parse(msg.data);\n        setValidationStyle(signup_form, el_email, response.error);\n        if (!response.error) {\n            document.querySelectorAll('.signup-form').forEach((el) => {\n                el.querySelector('.signup-form-input').classList.add('invisible');\n                el.querySelector('.signup-form-success').classList.remove('invisible');\n                email_sent = true;\n            });\n        }\n    }\n\n    function trimEmail(str) {\n        return str.replace(/\\s/g, '');\n    }\n\n    function checkCountry(val) {\n        const clients_country = sessionStorage.getItem('clients_country');\n        if ((clients_country !== 'my') || /@binary\\.com$/.test(val)) {\n            return true;\n        }\n        document.querySelectorAll('.signup-form').forEach((el) => {\n            el.querySelector('.signup-form-input').classList.add('invisible');\n            el.querySelector('.signup-form-error').classList.remove('invisible');\n        });\n        return false;\n    }\n\n    function connect() {\n        if (email_sent) return;\n        ws = wsConnect();\n        ws.onmessage = verifySubmit;\n        ws.onclose = connect;\n    }\n\n    let validation_set = false; // To prevent validating before submit\n\n    signup_form.addEventListener('submit', handleSubmit);\n\n    let el_email;\n    function handleSubmit(e) {\n        e.preventDefault();\n\n        const el_form  = this;\n        el_email = el_form.querySelector('input[type=\"email\"]');\n        if (!validateEmail(trimEmail(el_email.value))) {\n            if (!validation_set) {\n                ['input', 'change'].forEach((evt) => {\n                    el_email.addEventListener(evt, () => {\n                        setValidationStyle(signup_form, el_email, !validateEmail(trimEmail(el_email.value)));\n                    });\n                });\n                setValidationStyle(signup_form, el_email, !validateEmail(trimEmail(el_email.value)));\n                validation_set = true;\n            }\n\n            const to = this.offsetTop - 100;\n            scrollTo(to, 500); // Scroll to nearest form\n            return;\n        }\n\n        if (ws.readyState === 1) {\n            sendVerifyEmail(el_email.value);\n        } else {\n            ws.onopen = sendVerifyEmail(el_email.value);\n        }\n    }\n\n    ws.onmessage = verifySubmit;\n    ws.onclose = connect;\n}\n\nfunction validateEmail(email) {\n    return /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,63}$/.test(email);\n}\n\nfunction setValidationStyle(form, element, has_error) {\n    const error_class = 'error-field';\n    const invisible_class = 'invisible';\n\n    form.querySelectorAll('input[type=\"email\"]').forEach((el) => {\n        el.classList[has_error ? 'add' : 'remove'](error_class);\n    });\n\n    if (element.value.length < 1) {\n        form.querySelectorAll('.error_no_email').forEach((el) => {\n            el.classList[has_error ? 'remove' : 'add'](invisible_class);\n        });\n        form.querySelectorAll('.error_validate_email').forEach((el) => {\n            el.classList[has_error ? 'add' : 'remove'](invisible_class);\n        });\n    }\n    else if (element.value.length >= 1) {\n        form.querySelectorAll('.error_validate_email').forEach((el) => {\n            el.classList[has_error ? 'remove' : 'add'](invisible_class);\n        });\n        form.querySelectorAll('.error_no_email').forEach((el) => {\n            el.classList[has_error ? 'add' : 'remove'](invisible_class);\n        });\n    }\n    if (!has_error) {\n        form.querySelectorAll('.error_validate_email').forEach((el) => {\n            el.classList.add(invisible_class);\n        });\n        form.querySelectorAll('.error_no_email').forEach((el) => {\n            el.classList.add(invisible_class);\n        });\n    }\n}\n\nfunction getClientCountry() {\n    let clients_country = sessionStorage.getItem('clients_country');\n\n    // Try to get residence from client's info if logged-in\n    if (!clients_country) {\n        const accounts = JSON.parse(localStorage.getItem('client.accounts') || null);\n        if (accounts) {\n            Object.keys(accounts).some((loginid) => {\n                if (accounts[loginid].residence) {\n                    clients_country = accounts[loginid].residence;\n                    setSession('clients_country', clients_country);\n                    return true;\n                }\n                return false;\n            });\n        }\n    }\n\n    // Get required info from WebSocket\n    const ws = wsConnect();\n\n    function sendRequests() {\n        if (!clients_country) wsSend(ws, { website_status: 1 });\n        wsSend(ws, { time: 1 });\n    }\n\n    if (ws.readyState === 1) {\n        sendRequests();\n    } else {\n        ws.onopen = sendRequests;\n    }\n\n    ws.onmessage = function (msg) {\n        const response = JSON.parse(msg.data);\n        if (response.website_status) {\n            clients_country = response.website_status.clients_country;\n            setSession('clients_country', clients_country);\n        }\n    };\n\n    return clients_country;\n}"]}